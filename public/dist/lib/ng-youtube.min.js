/*! outsider 2017-05-30 */
angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function($window,$rootScope){function contains(str,substr){return str.indexOf(substr)>-1}function applyServiceIsReady(){$rootScope.$apply(function(){Service.ready=!0})}var Service={},youtubeRegexp=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,timeRegexp=/t=(\d+)[ms]?(\d+)?s?/;return Service.getIdFromURL=function(url){var id=url.replace(youtubeRegexp,"$1");if(contains(id,";")){var pieces=id.split(";");if(contains(pieces[1],"%")){var uriComponent=decodeURIComponent(pieces[1]);id=("http://youtube.com"+uriComponent).replace(youtubeRegexp,"$1")}else id=pieces[0]}else contains(id,"#")&&(id=id.split("#")[0]);return id},Service.getTimeFromURL=function(url){url=url||"";var times=url.match(timeRegexp);if(!times)return 0;var full=times[0],minutes=times[1],seconds=times[2];return"undefined"!=typeof seconds?(seconds=parseInt(seconds,10),minutes=parseInt(minutes,10)):contains(full,"m")?(minutes=parseInt(minutes,10),seconds=0):(seconds=parseInt(minutes,10),minutes=0),seconds+60*minutes},Service.ready=!1,"undefined"==typeof YT?$window.onYouTubeIframeAPIReady=applyServiceIsReady:YT.loaded?Service.ready=!0:YT.ready(applyServiceIsReady),Service}]).directive("youtubeVideo",["$window","youtubeEmbedUtils",function($window,youtubeEmbedUtils){var uniqId=1,stateNames={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},eventPrefix="youtube.player.";return $window.YTConfig={host:"https://www.youtube.com"},{restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(scope,element,attrs){function applyBroadcast(){var args=Array.prototype.slice.call(arguments);scope.$apply(function(){scope.$emit.apply(scope,args)})}function onPlayerStateChange(event){var state=stateNames[event.data];"undefined"!=typeof state&&applyBroadcast(eventPrefix+state,scope.player,event),scope.$apply(function(){scope.player.currentState=state})}function onPlayerReady(event){applyBroadcast(eventPrefix+"ready",scope.player,event)}function onPlayerError(event){applyBroadcast(eventPrefix+"error",scope.player,event)}function createPlayer(){var playerVars=angular.copy(scope.playerVars);playerVars.start=playerVars.start||scope.urlStartTime;var player=new YT.Player(playerId,{height:scope.playerHeight,width:scope.playerWidth,videoId:scope.videoId,playerVars:playerVars,events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange,onError:onPlayerError}});return player.id=playerId,player}function loadPlayer(){(scope.videoId||scope.playerVars.list)&&(scope.player&&"function"==typeof scope.player.destroy&&scope.player.destroy(),scope.player=createPlayer())}scope.utils=youtubeEmbedUtils;var playerId=attrs.playerId||element[0].id||"unique-youtube-embed-id-"+uniqId++;element[0].id=playerId,scope.playerHeight=scope.playerHeight||390,scope.playerWidth=scope.playerWidth||640,scope.playerVars=scope.playerVars||{};var stopWatchingReady=scope.$watch(function(){return scope.utils.ready&&("undefined"!=typeof scope.videoUrl||"undefined"!=typeof scope.videoId||"undefined"!=typeof scope.playerVars.list)},function(ready){ready&&(stopWatchingReady(),"undefined"!=typeof scope.videoUrl?scope.$watch("videoUrl",function(url){scope.videoId=scope.utils.getIdFromURL(url),scope.urlStartTime=scope.utils.getTimeFromURL(url),loadPlayer()}):"undefined"!=typeof scope.videoId?scope.$watch("videoId",function(){scope.urlStartTime=null,loadPlayer()}):scope.$watch("playerVars.list",function(){scope.urlStartTime=null,loadPlayer()}))});scope.$watchCollection(["playerHeight","playerWidth"],function(){scope.player&&scope.player.setSize(scope.playerWidth,scope.playerHeight)}),scope.$on("$destroy",function(){scope.player&&scope.player.destroy()})}}}]);