/*! outsider 2017-05-30 */
angular.module("mainCtrl",[]).controller("mainController",["$rootScope","$location","Auth","$scope","Token","Modal","$http","Bucket","$window","toasty",function($rootScope,$location,Auth,$scope,Token,Modal,$http,Bucket,$window,toasty){var ctrl=this;ctrl.error=[],ctrl.collapsed=!0,$window.analyticsMode="none",ctrl.motd='Go have an adventure <i><a href="https://twitter.com/hashtag/getoutthere">#getoutthere</a></i>',$http.get("/servermode").then(function(response){1==response.data.success&&(Bucket.set(response.data.data),ctrl.bucket=Bucket.get(),"production"==response.data.env&&($window.analyticsMode="auto"))});var dateNow=Date.now();void 0!==Auth.getUser()&&dateNow/1e3>Auth.getUser().exp&&(Token.set(),Auth.setUser()),ctrl.hasError=function(field){for(var l=0;l<ctrl.error.length;l++)if(ctrl.error[l].field===field)return"has-error";return""},$scope.$watch(Auth.isLoggedIn,function(logged){ctrl.loggedIn=logged}),$scope.$watch(Auth.getUser,function(user){ctrl.user=user}),$rootScope.$on("$routeChangeSuccess",function(){$location.path().indexOf("/admin")>-1?ctrl.hideJumbo=!0:ctrl.hideJumbo=!1}),ctrl.login=function(){return ctrl.loginData?void Auth.login(ctrl.loginData.email,ctrl.loginData.password).success(function(data){console.log(data),data.success?(Auth.setUser(data.data),toasty.success({title:"Successful Login",msg:"Welcome back "+data.data.first_name,sticky:!0}),$location.path("/profile")):(ctrl.error.push(data.error),toasty.error({title:"Login Failed",msg:data.error}))}):void toasty.error({title:"Login Failed",msg:"Email and password cannot be blank"})},ctrl.logout=function(){Auth.logout(),Auth.setUser(),$location.path("/"),ctrl.collapsed=!0}}]).directive("hideUnless",["ngIfDirective","Auth",function(ngIfDirective,Auth){var ngIf=ngIfDirective[0];return{transclude:ngIf.transclude,priority:ngIf.priority-1,terminal:ngIf.terminal,restrict:ngIf.restrict,link:function($scope,$element,$attr){function getRole(){var role=!!Auth.getUser()&&Auth.getUser().role;if(role)return role.toString().indexOf(reqRole)>-1}var ifEval,reqRole=$attr.hideUnless,initialNgIf=$attr.ngIf;ifEval=initialNgIf?function(){return $scope.$eval(initialNgIf)&&getRole()}:function(){return getRole()},$attr.ngIf=ifEval,ngIf.link.apply(ngIf,arguments)}}}]).directive("ifPathContains",["ngIfDirective","$location",function(ngIfDirective,$location){var ngIf=ngIfDirective[0];return{transclude:ngIf.transclude,priority:ngIf.priority,terminal:ngIf.terminal,restrict:ngIf.restrict,link:function($scope,$element,$attr){var path=$attr.ifPathContains;$attr.ngIf=function(){return $location.path().indexOf(path)>-1},ngIf.link.apply(ngIf,arguments)}}}]);