/*! outsider 2016-10-29 */
angular.module("imageCtrl",[]).controller("imageController",["Image","close","$scope","requiredCrop",function(Image,close,$scope,requiredCrop){var ctrl=this;ctrl.mess="Image Select",ctrl.error=[],ctrl.data={},ctrl.data.files=[],ctrl.data.images=[],ctrl.activeImage=void 0,ctrl.cropToolsEnabled=!1,ctrl.cropAspectRatio=requiredCrop,ctrl.offsetX,ctrl.offsetY,ctrl.cropWidth,ctrl.cropHeight,ctrl.modeMessage="Select an article cover image",ctrl.currentPage="page-id-1",ctrl.cropSuccess=!1,ctrl.setPage=function(page){ctrl.currentPage="page-id-"+page},ctrl.toLocaleDate=function(e){var date=new Date(e.createdAt);return e.createdAt=date.toLocaleDateString(),e},ctrl.fetchImages=function(){Image.all().then(function(response){ctrl.data.images=response.data.data})},ctrl.saveCrop=function(){var data={};data.image=ctrl.activeImage,data.cropOffsetX=ctrl.offsetX,data.cropOffsetY=ctrl.offsetY,data.cropWidth=ctrl.cropWidth,data.cropHeight=ctrl.cropHeight,Image.crop(data).then(function(response){ctrl.cropSuccess=!0})},ctrl.select=function(i){var images=ctrl.data.images;if(index=images.indexOf(i),ctrl.activeImage=images[index],ctrl.activeImage.index=index,ctrl.activeImageUrl="https://s3-eu-west-1.amazonaws.com/images.outsider/medium/"+images[index].filename,images[index].selected)ctrl.activeImage=void 0,images[index].selected=!1,ctrl.cropToolsEnabled=!1;else{for(var i=0;i<images.length;i++)images[i].selected=!1;images[index].selected=!0,ctrl.cropToolsEnabled=!1}},ctrl.uploadFiles=function(files){for(;files.length>0;){var currentFile=files.shift();Image.add(currentFile).then(function(response){console.log(response.data),response.data.data.selected=!1,ctrl.data.images.unshift(response.data.data)})}},$scope.$watch("image.data.files",function(){ctrl.error=[];for(var file,files=ctrl.data.files,i=files.length-1;i>=0;i--)file=files[i],"maxSize"==file.$error?(console.log(file),ctrl.error.push({message:'File "'+file.name+'" could not be uploaded because it is larger than '+file.$errorParam}),files.splice(i,1)):"pattern"==file.$error&&(ctrl.error.push({message:'File "'+file.name+'" could not be uploaded because it is not an image'}),files.splice(i,1));null==files&&0==files.length||ctrl.uploadFiles(files)}),ctrl.cancel=close,ctrl.submit=function(){for(var returnData,images=ctrl.data.images,i=0;i<images.length;i++)if(1==images[i].selected){returnData=images[i];break}void 0!=returnData?close(returnData):ctrl.error=[{message:"You need to choose an image, you 🍩"}]},ctrl.fetchImages()}]);