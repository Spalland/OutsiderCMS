/*! outsider 2017-05-30 */
angular.module("userCtrl",[]).controller("userController",["User","$location","$routeParams","toasty",function(User,$location,$routeParams,toasty){var ctrl=this;ctrl.signupData={},ctrl.error=[],ctrl.signupData.first_name="",ctrl.signupData.last_name="",ctrl.signupData.email="",ctrl.signupData.password="",ctrl.signupData.username="",ctrl.forgotSuccess=!1,$routeParams.token&&(ctrl.signupData.token=$routeParams.token),ctrl.hasError=function(field){for(var l=0;l<ctrl.error.length;l++)if(ctrl.error[l].field===field)return"has-error";return""},ctrl.signup=function(){User.create(ctrl.signupData).success(function(data){data.success?(console.log(data),toasty.success({title:"Successful Signup",msg:"Thanks for joining Outsider.guide "+data.data.first_name+". You have been sent an email to verify your address.",sticky:!0}),$location.path("/login")):(ctrl.error.push(data),console.log(data),toasty.error({title:"Uh oh",msg:data.error}))})},ctrl.forgot=function(){User.forgot({email:ctrl.signupData.email}).success(function(data){data.success?(ctrl.forgotSuccess=!0,toasty.success({title:"Reset email sent",msg:"You have been sent an email to reset your password.",sticky:!0}),$location.path("/")):(ctrl.error.push(data),toasty.error({title:"Uh oh",msg:data.error}))})},ctrl.reset=function(){User.reset({password:ctrl.signupData.password,token:$routeParams.token}).success(function(data){console.log(data),data.success?$location.path("/login"):(ctrl.error.push(data),toasty.error({title:"Uh oh",msg:data.error}))})},ctrl.verify=function(){User.verify({email:ctrl.signupData.email,password:ctrl.signupData.password,token:$routeParams.token}).success(function(data){data.success?$location.path("/login"):(ctrl.error.push(data),toasty.error({title:"Uh oh",msg:data.error}))})}}]);